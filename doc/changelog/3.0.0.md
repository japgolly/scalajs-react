# 3.0.0

## New

- React 18 support
  - List of implemented features is here: https://github.com/japgolly/scalajs-react/issues/1057
  - For the moment, using class components emits the `Until you switch to the new API, your app will behave as if it’s running React 17.` warning, even if the app was initialized the React 18 way (see [here](https://react.dev/blog/2022/03/08/react-18-upgrade-guide#updates-to-client-rendering-apis)).

- `React.majorVersion: Int`

- `ScalaFnComponent` and `ScalaForwardRef` now support `.withDisplayName(name)`. Must be called first (before hooks/`render*`/`withChildren*`).

  Example:

  ```scala
    ScalaFnComponent.withDisplayName("MyComponent")
      .withHooks[Props]
      .useState(0)
      .render((_, s) => s.value.toString)
  ```

  If not specified, a unique name will be inferred from the fully qualified name of the call site.

- Monadic hooks! [See documentation here](../HOOKS.md).

- `ReactTestUtils` has been replaced. The old version has been renamed to `LegacyReactTestUtils`. [See a demo here](../TESTING.md), and see a migration script below.

- `Renderable` typeclass for anything that React can render

## Other Changes

- Allow calling `useCallback*` with sync functions that return a value.

- Router
  - Wrap router actions in `startTransition`, making the change of pages interruptible.
  - Allow creating custom `Route` instances outside the DSL model. A `Route` just wraps functions to turn a `Path` into a potential page and vice-versa.

- The ability to globally turn React warnings into errors via sbt system properties has been removed.
  It's test case had an error in it — it never worked as intended.

- `TriStateCheckbox` no longer uses `Reusability.shouldComponentUpdate`, therefore
  the fourth argument to its props is no longer wrapped in `Reusable`.

## Deprecated

- Anything deprecated by React 18 is now deprecated in Scala

- `.renderBackend` — see https://github.com/japgolly/scalajs-react/pull/1125 for how to replace it

- `ReusabilityOverlay` is now deprecated without replacement. It relied on `ReactDOM.findDOMNode` which has been removed in React 19.

- `ReactTestUtils` is now `LegacyReactTestUtils` and deprecated

## Upgrades

- Cats 2.13.0
- CatsEffect 3.6.3
- Microlibs 4.2.1
- Monocle3 3.3.0
- Scala 2.13.17
- ScalaJS 1.20.1
- ScalaJsDom 2.8.1
- Sourcecode 0.4.4

## Migration

### `jsDependencies`

To upgrade when using `jsDependencies`, make your sbt config look like this (comments for clarity)

```scala
// Required for React 18.3.1
dependencyOverrides += "org.webjars.npm" % "scheduler" % "0.22.0",

jsDependencies ++= Seq(

  // Polyfill required for React 18.3.1
  "org.webjars.npm" % "fast-text-encoding" % "1.0.6" / "1.0.6/text.min.js" minified "text.min.js"

  "org.webjars.npm" % "react" % "18.3.1"
    /         "umd/react.development.js"
    minified  "umd/react.production.min.js"
    dependsOn "text.js" // <-- Load the fast-text-encoding polyfill before loading React itself
    commonJSName "React",

  "org.webjars.npm" % "react-dom" % "18.3.1"
    /         "umd/react-dom.development.js"
    minified  "umd/react-dom.production.min.js"
    dependsOn "umd/react.development.js"
    commonJSName "ReactDOM",

  "org.webjars.npm" % "react-dom" % "18.3.1"
    /         "umd/react-dom-server.browser.development.js"
    minified  "umd/react-dom-server.browser.production.min.js"
    dependsOn "umd/react-dom.development.js"
    commonJSName "ReactDOMServer",
),
```

### `ReactTestUtils`

Run this to switch from `{ => Legacy}ReactTestUtils`, and if you were on the betas `ReactTestUtils{2 => }`:

```sh
find . -type f -name '*.scala' -exec perl -pi -e '
  s/\bReactTestUtils\b/LegacyReactTestUtils/g;
  s/\bReactTestUtils2\b/ReactTestUtils/g;
' {} +
```

### `Simulate`, `SimEvent`, `Simulation`

React has removed `Simulate` as of React v19. It is deprecated in React v18.

React now recommends using [React Testing Library](https://testing-library.com/react) instead.
There is no Scala.js facade for it, and even if there was it wouldn't be a drop-in replacement.

As a band-aid solution, there is now a new scalajs-react module called `testing_library-dom`
that builds on `@testing-library/dom` and
provides a subset of `Simulate`, `SimEvent`, `Simulation` under the
`japgolly.scalajs.react.testing_library.dom` package.

Unfortunately some types of events like `Simulate.change` do not fire and thus have been removed from the API.

Add this to your sbt:

```scala
libraryDependencies += "com.github.japgolly.scalajs-react" %%% "testing_library-dom" % "3.0.0" % Test

jsDependencies += "org.webjars.npm" % "testing-library__dom" % "10.4.1" /
                    "dom.umd.js" commonJSName "TestingLibraryDom" % Test
```

and to use it:

```scala
import japgolly.scalajs.react.testing_library.dom.Simulate

// Simulate.click(domNode)
```
