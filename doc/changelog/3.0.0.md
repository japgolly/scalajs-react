# 3.0.0

### New

- React 18 support
  - List of implemented features is here: https://github.com/japgolly/scalajs-react/issues/1057
  - For the moment, using class components emits the `Until you switch to the new API, your app will behave as if it’s running React 17.` warning, even if the app was initialized the React 18 way (see [here](https://react.dev/blog/2022/03/08/react-18-upgrade-guide#updates-to-client-rendering-apis)).

- `React.majorVersion: Int`

- `ScalaFnComponent` and `ScalaForwardRef` now support `.withDisplayName(name)`. Must be called first (before hooks/`render*`/`withChildren*`).

  Example:

  ```scala
    ScalaFnComponent.withDisplayName("MyComponent")
      .withHooks[Props]
      .useState(0)
      .render((_, s) => s.value.toString)
  ```

  If not specified, a unique name will be inferred from the fully qualified name of the call site.

- Monadic hooks! [See documentation here](../HOOKS.md).

- `ReactTestUtils` has been replaced. The old version has been renamed to `LegacyReactTestUtils`. [See a demo here](../TESTING.md), and see a migration script below.

- `Renderable` typeclass for anything that React can render

### Other Changes

- Allow calling `useCallback*` with sync functions that return a value.

- Router
  - Wrap router actions in `startTransition`, making the change of pages interruptible.
  - Allow creating custom `Route` instances outside the DSL model. A `Route` just wraps functions to turn a `Path` into a potential page and vice-versa.

### Deprecated

- Anything deprecated by React 18 is now deprecated in Scala

- `.renderBackend` — see https://github.com/japgolly/scalajs-react/pull/1125 for how to replace it

- `ReactTestUtils` is now `LegacyReactTestUtils` and deprecated

### Upgrades

- Cats 2.13.0
- CatsEffect 3.6.3
- Microlibs 4.2.1
- Monocle3 3.3.0
- Scala 2.13.17
- ScalaJS 1.20.1
- ScalaJsDom 2.8.1
- Sourcecode 0.4.4

### Migration

- Run this to switch from `{ => Legacy}ReactTestUtils`, and if you were on the betas `ReactTestUtils{2 => }`:

    ```sh
    find . -type f -name '*.scala' -exec perl -pi -e '
      s/\bReactTestUtils\b/LegacyReactTestUtils/g;
      s/\bReactTestUtils2\b/ReactTestUtils/g;
    ' {} +
    ```

- To upgrade when using `jsDependencies`, make your sbt config look like this (comments for clarity)

  ```scala
  // Required for React 18.0.0
  dependencyOverrides += "org.webjars.npm" % "scheduler" % "0.22.0",

  jsDependencies ++= Seq(

    // Polyfill required for React 18.0.0
    "org.webjars.npm" % "fast-text-encoding" % "1.0.3" / "text.js" minified "text.min.js"

    "org.webjars.npm" % "react" % "18.0.0"
      /         "umd/react.development.js"
      minified  "umd/react.production.min.js"
      dependsOn "text.js" // <-- Load the fast-text-encoding polyfill before loading React itself
      commonJSName "React",

    "org.webjars.npm" % "react-dom" % "18.0.0"
      /         "umd/react-dom.development.js"
      minified  "umd/react-dom.production.min.js"
      dependsOn "umd/react.development.js"
      commonJSName "ReactDOM",

    "org.webjars.npm" % "react-dom" % "18.0.0"
      /         "umd/react-dom-server.browser.development.js"
      minified  "umd/react-dom-server.browser.production.min.js"
      dependsOn "umd/react-dom.development.js"
      commonJSName "ReactDOMServer",
  ),
  ```
